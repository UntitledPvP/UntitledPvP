const Discord = require("discord.js");
const client = new Discord.Client();
const Prefix = "%";

client.on('ready', () => {
    console.log('â•”[â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•]â•—');
    console.log('')
    console.log('            â•”[â•â•â•â•â•â•â•â•â•â•â•â•]â•—')
    console.log('              Bot Is Online')
    console.log('            â•š[â•â•â•â•â•â•â•â•â•â•â•â•]â•')
    console.log('')
    console.log(`Logged in as ${client.user.tag}!`);
    console.log('')
    console.log(`servers! [ " ${client.guilds.size} " ]`);
    console.log('')
    console.log(`Users! [ " ${client.users.size} " ]`);
    console.log('')
    console.log('â•š[â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•]â•')
});

client.on("message", (message) => {
  if (message.content.startsWith(Prefix + "help")) {
    message.channel.send("```\n%**help**  Shows This Menu\n**%invite** Invite the Bot \n**%id** User Informations\n**%bc** Broadcast a Message For all Server Members\n**%server** Server Informations\n**%croles** To Create Ready Roles (Down) \n**%moveall** Move all Members to your Voice Channel\n**%info** Bot Informations ```");
  }
});

client.on('message', msg => {
    if (msg.content === "%invite") {
      msg.reply('https://discordapp.com/api/oauth2/authorize?client_id=477102530971566113&permissions=0&scope=bot');
    }
});

client.on('message', message => {
    if (message.content.startsWith("%id")) {
                 if(!message.channel.guild) return message.reply('** This command only for servers**');
 
                var mentionned = message.mentions.users.first();
     var mentionavatar;
       if(mentionned){
           var mentionavatar = mentionned;
       } else {
           var mentionavatar = message.author;
           
       }
    let embed = new Discord.RichEmbed()
   .setColor("RANDOM")
    .setThumbnail(`${mentionavatar.avatarURL}`)
   .addField("Name:",`<@` + `${mentionavatar.id}` + `>`, true)
   .addField('Discrim:',"#" +  `${mentionavatar.discriminator}`, true)
    .addField("ID:", "**[" + `${mentionavatar.id}` + "]**", true)
   .addField("Create At:", "**[" + `${mentionavatar.createdAt}` + "]**", true)
      
      
   message.channel.sendEmbed(embed);
   console.log('[id] Send By: ' + message.author.username)
     }
});

client.on('message', message => {
    
        if (message.author.id === client.user.id) return;
        if (message.guild) {
       let embed = new Discord.RichEmbed()
        let args = message.content.split(' ').slice(1).join(' ');
    if(message.content.split(' ')[0] == "%bc") {
        if (!args[1]) {
    message.channel.send("**%bc <message>**");
    return;
    }
            message.guild.members.forEach(m => {
       if(!message.member.hasPermission('ADMINISTRATOR')) return;
                var bc = new Discord.RichEmbed()
                .addField('Â» Server :', `${message.guild.name}`)
                .addField('Â» Sender : ', `${message.author.username}#${message.author.discriminator}`)
                .addField(' Â» Message : ', args)
                .setColor('#ff0000')
                // m.send(`[${m}]`);
                m.send(`${m}`,{embed: bc});
            });
        }
        } else {
            return;
        }
});

client.on('message', function(msg) {
    if(msg.content.startsWith ("%server")) {
      let embed = new Discord.RichEmbed()
      .setColor('RANDOM')
      .setThumbnail(msg.guild.iconURL)
      .setTitle(`Showing Details Of  **${msg.guild.name}*`)
      .addField('ðŸŒ** Server Region**',`[** __${msg.guild.region}__ **]`,true)
      .addField('ðŸ…** __Roles__**',`[** __${msg.guild.roles.size}__ **]`,true)
      .addField('ðŸ”´**__ Member__**',`[** __${msg.guild.memberCount}__ **]`,true)
      .addField('ðŸ”µ**__ Online Members__**',`[** __${msg.guild.members.filter(m=>m.presence.status == 'online').size}__ **]`,true)
      .addField('ðŸ“**__ Chat Channels__**',`[** __${msg.guild.channels.filter(m => m.type === 'text').size}__** ]`,true)
      .addField('ðŸŽ¤**__ Voice Channels__**',`[** __${msg.guild.channels.filter(m => m.type === 'voice').size}__ **]`,true)
      .addField('ðŸ‘‘**__ Owner__**',`**${msg.guild.owner}**`,true)
      .addField('ðŸ†”**__ Server ID__**',`**${msg.guild.id}**`,true)
      .addField('ðŸ“…**__ Server Created At__**',msg.guild.createdAt.toLocaleString())
      msg.channel.send({embed:embed});
    }
});

client.on('message', message => {
    if(message.content.includes('discord.gg')){
                                            if(!message.channel.guild) return message.reply('** advertising me on DM ? ðŸ¤”   **');
        if (!message.member.hasPermissions(['ADMINISTRATOR'])){
        message.delete()
    return message.reply(`** Links aren't allowed :angry: ! **`)
    }
}
});

client.on('message', message => {
    if(message.content.includes('youtube')){
                                            if(!message.channel.guild) return message.reply('** advertising me on DM ? ðŸ¤”   **');
        if (!message.member.hasPermissions(['ADMINISTRATOR'])){
        message.delete()
    return message.reply(`** Links aren't allowed :angry: ! **`)
    }
}
});

client.on('message', message => {
    if (message.content === "%croles") {
    if(!message.channel.guild) return message.channel.send('**This Command Only For Servers !**')
            if (!message.member.hasPermission('MANAGE_ROLES')) return message.channel.send(`**${message.author.username} You Dont Have** ``MANAGE_ROLES`` **Premission**`);

                     message.guild.createRole({ name: "Owner", color: "#0a0a0a", permissions: [] })
                     message.guild.createRole({ name: "Co-Owner", color: "#dd0fd3", permissions: [] })
                     message.guild.createRole({ name: "Admin", color: "#a80608", permissions: [] })
                     message.guild.createRole({ name: "Mod", color: "#07ac1e", permissions: [] })
                     message.guild.createRole({ name: "Staff", color: "#ac3607", permissions: [] })
                     message.guild.createRole({ name: "Support", color: "#ffffff", permissions: [] })
                     message.guild.createRole({ name: "King", color: "#ffffff", permissions: [] })
                     message.guild.createRole({ name: "Qween", color: "#ffffff", permissions: [] })
                     message.guild.createRole({ name: "HighNiss", color: "#ffffff", permissions: [] })
                     message.guild.createRole({ name: "Pros", color: "#ffffff", permissions: [] })
                     message.guild.createRole({ name: "VIP+", color: "#ffffff", permissions: [] })
                     message.guild.createRole({ name: "VIP", color: "#ffffff", permissions: [] })
                     message.guild.createRole({ name: "Active", color: "#ffffff", permissions: [] })
                     message.guild.createRole({ name: "Members", color: "#ffffff", permissions: [] })
        

message.channel.sendMessage('**Please wait Untill __Roles__ are Created **')
}
});

client.on('message', message => {
    if(message.content.startsWith("%moveall")) {
     if (!message.member.hasPermission("MOVE_MEMBERS")) return message.channel.send('**Ù„Ø§ÙŠÙˆØ¬Ø¯ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø³Ø­Ø¨ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡**');
       if(!message.guild.member(client.user).hasPermission("MOVE_MEMBERS")) return message.reply("**Ù„Ø§ÙŠÙˆØ¬Ø¯ Ù„Ø¯ÙŠ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø³Ø­Ø¨**");
    if (message.member.voiceChannel == null) return message.channel.send(`**Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø±ÙˆÙ… ØµÙˆØªÙŠ**`)
     var author = message.member.voiceChannelID;
     var m = message.guild.members.filter(m=>m.voiceChannel)
     message.guild.members.filter(m=>m.voiceChannel).forEach(m => {
     m.setVoiceChannel(author)
     })
     message.channel.send(`**All Members have been __Moved__**`)
    
    
     }
});

function timeCon(time) {
    let days = Math.floor(time % 31536000 / 86400)
    let hours = Math.floor(time % 31536000 % 86400 / 3600)
    let minutes = Math.floor(time % 31536000 % 86400 % 3600 / 60)
    let seconds = Math.round(time % 31536000 % 86400 % 3600 % 60)
    days = days > 9 ? days : '0' + days
    hours = hours > 9 ? hours : '0' + hours
    minutes = minutes > 9 ? minutes : '0' + minutes
    seconds = seconds > 9 ? seconds : '0' + seconds
    return `${days > 0 ? `${days}:` : ''}${(hours || days) > 0 ? `${hours}:` : ''}${minutes}:${seconds}`
}
client.on('message', message => {
    if (message.content.startsWith("%info")) {
    message.channel.send({
        embed: new Discord.RichEmbed()
            .setAuthor(client.user.username,client.user.avatarURL)
            .setThumbnail(client.user.avatarURL)
            .setColor('RANDOM')
            .setTitle('``INFO Arab Bot`` ')
            .addField('``Uptime``', [timeCon(process.uptime())], true)
            .addField('``My Ping``' , [`${Date.now() - message.createdTimestamp}` + 'MS'], true)
            .addField('``RAM Usage``', `[${(process.memoryUsage().rss / 1048576).toFixed()}MB]`, true)
            .addField('``servers``', [client.guilds.size], true)
            .addField('``channels``' , `[ ${client.channels.size} ]` , true)
            .addField('``Users``' ,`[ ${client.users.size} ]` , true)
            .addField('``My Name``' , `[ ${client.user.tag} ]` , true)
            .addField('``My ID``' , `[ ${client.user.id} ]` , true)
                  .addField('``My Prefix``' , `.` , true)
                  .addField('``My Language``' , `[ Java Script ]` , true)
                  .setFooter('By | YodaBrro#4557')
    })
}
});

client.on('message', message => {
    if (message.content.startsWith("%new")) {
        const reason = message.content.split(" ").slice(1).join(" ");
        if (!message.guild.roles.exists("name", "Support Team")) return message.channel.send(`This server doesn't have a \`Support Team\` role made, so the ticket won't be opened.\nIf you are an administrator, make one with that name exactly and give it to users that should be able to see tickets.`);
        if (message.guild.channels.exists("name", "ticket-" + message.author.id)) return message.channel.send(`You already have a ticket open.`);
        message.guild.createChannel(`ticket-${message.author.discriminator}`, "text").then(c => {
            let role = message.guild.roles.find("name", "Support Team");
            let role2 = message.guild.roles.find("name", "@everyone");
            c.overwritePermissions(role, {
                SEND_MESSAGES: true,
                READ_MESSAGES: true
            });
            c.overwritePermissions(role2, {
                SEND_MESSAGES: false,
                READ_MESSAGES: false
            });
            c.overwritePermissions(message.author, {
                SEND_MESSAGES: true,
                READ_MESSAGES: true
            });
            message.channel.send(`:white_check_mark: Your ticket has been created, #${c.name}.`);
            const embed = new Discord.RichEmbed()
                .setColor(0xCF40FA)
                .addField(`Hey ${message.author.username}!`, `Please try explain why you opened this ticket with as much detail as possible. Our **Support Staff** will be here soon to help.`)
                .setTimestamp();
            c.send({
                embed: embed
            });
        }).catch(console.error); 
    }


    if (message.content.startsWith("%close")) {
        if (!message.channel.name.startsWith(`ticket-`)) return message.channel.send(`You can't use the close command outside of a ticket channel.`);

        message.channel.send(`Are you sure? Once confirmed, you cannot reverse this action!\nTo confirm, type \`.close\`. This will time out in 10 seconds and be cancelled.`)
            .then((m) => {
                message.channel.awaitMessages(response => response.content === '%close', {
                        max: 1,
                        time: 10000,
                        errors: ['time'],
                    })
                    .then((collected) => {
                        message.channel.delete();
                    })
                    .catch(() => {
                        m.edit('Ticket close timed out, the ticket was not closed.').then(m2 => {
                            m2.delete();
                        }, 3000);
                    });
            });
    }

});

client.on("message", (message) => {
    if (message.content.startsWith("%ban")) {
      if(!message.member.hasPermission('BAN_MEMBERS')) return message.reply(':warning: Ù…Ø§Ø¹Ù†Ø¯Ùƒ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª');
        var member= message.mentions.members.first();
        member.ban().then((member) => {
            message.channel.send(member.displayName + " Ù…Ø¹ Ø§Ù„Ø³Ù„Ø§Ù…Ù‡ :wave: ");
        }).catch(() => {
        });
    }
});
  
client.on('message', message => {
    if (message.author.bot) return;
    if (!message.content.startsWith("%embed")) return;
  
    let command = message.content.split(" ")[0];
    command = command.slice(Prefix.length);
  
    let args = message.content.split(" ").slice(1);
    
   
  
  if (command == "%embed") {
      let say = new Discord.RichEmbed()
      .setDescription(args.join("  "))
      .setColor(0x23b2d6)
      message.channel.sendEmbed(say);
      message.delete();
    }
  
  
});

client.on('message', message => {
    let reason = message.content.split(" ").slice(2).join(" ")
    let muterole = message.guild.roles.find("name", "muted")
    let men = message.mentions.users.first()

    if(message.content.startsWith("%mute")) {
        if(!men) return message.channel.send("**Do you want me to mute you ðŸ¤” ?, please @mention someone. `Ex. #mute @xRokz bad boy`**");
        if(!reason) return message.channel.send("**Do you want me to mute " + men.username + " with no reason ?, `Ex. #mute @xRokz bad boy` or just use `none` for no reason **`")
        if(!muterole) {
            message.guild.createRole({name: "muted", color:"#505f74", permissions: [1115136]})

        }
        message.guild.member(men).addRole(muterole)
            message.channel.send("**" + men.username + " has been muted! :zipper_mouth:**")
    }

    if(message.content.startsWith("%unmute")) {
        if(!men) return message.channel.send("**please @mention someone. `Ex. #unmute <@!298732816995319809> bad boy`**");

        if(!muterole) {
            message.guild.createRole({name: "muted", color:"#505f74", permissions: [1115136]})

        }
        message.guild.member(men).removeRole(muterole)
            message.channel.send("**" + men.username + " has been unmuted! ðŸ˜€ **")
    }
});
  
  client.login(process.env.BOT_TOKEN);  //Ù„Ø§ ØªØ­Ø· Ø§Ù„ØªÙˆÙƒÙ† Ø­Ù‚Ùƒ Ù‡Ù†Ø§
